<?xml version="1.1" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version="1.5" reference="Confluence.Macros.recently-updated" locale="">
  <web>Confluence.Macros</web>
  <name>recently-updated</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <originalMetadataAuthor>XWiki.Admin</originalMetadataAuthor>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <version>1.1</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>The recently-updated macro is a bridge between Confluence and XWiki. It displays the most recent contributions to the wiki, relative to documents, attachments and comments.

There are only a few things that are not supported compared to the confluence macro, due to differences between the two:
* some special values of the {{{ spaces }}} parameters are not supported: {{{ @personal }}}, {{{ @favorite }}} / {{{ @favourite }}}, and personal spaces starting with a "~~"

= Parameters =

|=Parameter|=Description|=Required|=Default
|**types**|Comma-separated list of types ({{{ page }}}, {{{ blogpost }}}, {{{ comment }}} or {{{ attachment }}}), possibly prefixed with "-".|No|//all types//
|**spaces**|Comma-separated list of spaces, possibly prefixed with "+" or "-", or special value like {{{ @self }}}, {{{ @global }}} or {{{ @all }}}.|No|{{{ @self }}}
|**author**|Comma-separated list of authors.|No| 
|**labels**|Comma-separated list of tags, possibly prefixed with "+" or "-".|No| 
|**max**|Maximum number of results.|No| {{{ 15 }}}
|**theme**|Appearance of the macro ({{{ concise }}}, {{{ social }}}, {{{ sidebar }}}).|No| {{{ concise }}}
|**width**|Width of the macro in percentage.|No| {{{ 100% }}}
|**hideHeading**|Whether to hide the text "Recently Updated" as title|No| {{{ false }}}
|**showProfilePic**|Whether to show the profile picture of users|No| {{{ false }}}


= Example Usage =

{{code}}
{{recently-updated
  spaces="@global"
  theme="concise"
  max="5"
/}}
{{/code}}

{{recently-updated
  spaces="@global"
  theme="concise"
  max="5"
/}}

== TODO ==
* add button to fetch more results
* test more thoroughly on subwikis</content>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>3b3cfea7-37ba-41a1-af19-203cd936d122</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <defaultValue>long</defaultValue>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>6</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>
.recently-updated-macro {
  ul.items {
    padding: 0rem;

    &amp;.theme-concise,
    &amp;.theme-sidebar {
      li {
        list-style-type: none;
        margin-bottom: 1rem;

        .result-item {
          display: grid;
          grid-template-areas:
            'icon title'
            '_ metadata';
          grid-template-columns: auto 1fr;
          align-items: center;
          column-gap: 0.6rem;

          .result-icon {
            grid-area: icon;
          }

          .result-title {
            grid-area: title;

            a:empty{
              .text-muted();

              &amp;::before {
                content: '(no title)';
                font-style: italic;
              }
            }
          }

          .result-metadata {
            grid-area: metadata;
            .text-muted-smaller();

            .result-last-author-avatar img.avatar {
              display: inline-block;
              width: 1em;
              height: 1em;
              border-radius: 100vw;
            }

            .result-last-author-name {
              color: @link-color;
            }
          }
        }
      }
    }

    &amp;.theme-social {
      li {
        list-style-type: none;
        margin-bottom: 1rem;

        .result-container {
          display: flex;
          flex-direction: row;
          justify-content: flex-start;
          align-items: flex-start;
          column-gap: 0.6rem;

          &amp;.collapsed {
            .result-last-author-avatar img.avatar {
              display: none;
            }

            .result-items .result-last-author-name {
              display: none;
            }
          }

          .result-last-author-avatar {
            flex: 0 0 48px;

            img.avatar {
              border-radius: 100vw;
            }
          }

          .result-items {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            row-gap: 1rem;

            .result-last-author-name {
              color: @link-color;
              font-weight: bold;
            }

            .result-item {
              .result-title a:empty{
                .text-muted();

                &amp;::before {
                  content: '(no title)';
                  font-style: italic;
                }
              }

              .result-metadata {
                .text-muted();
              }
            }
          }
        }
      }
    }
  }
}</code>
    </property>
    <property>
      <contentType>LESS</contentType>
    </property>
    <property>
      <name/>
    </property>
    <property>
      <parse>0</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>1</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>48479d96-b2e8-4658-936d-0f87dad48af2</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <defaultValue>long</defaultValue>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>6</number>
        <prettyName>Content Type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>CSS|LESS</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage|onDemand|always</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>
.recently-updated-macro {
  width: var(--width);
}</code>
    </property>
    <property>
      <contentType>CSS</contentType>
    </property>
    <property>
      <name>container width</name>
    </property>
    <property>
      <parse>1</parse>
    </property>
    <property>
      <use>onDemand</use>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>0</number>
    <className>XWiki.WikiMacroClass</className>
    <guid>788b8823-af80-4f49-bc96-0f8431187c27</guid>
    <class>
      <name>XWiki.WikiMacroClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <async_cached>
        <defaultValue>0</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType/>
        <name>async_cached</name>
        <number>13</number>
        <prettyName>Cached</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </async_cached>
      <async_context>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>1</multiSelect>
        <name>async_context</name>
        <number>14</number>
        <prettyName>Context elements</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>, </separator>
        <separators>|, </separators>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </async_context>
      <async_enabled>
        <defaultValue>0</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType/>
        <name>async_enabled</name>
        <number>12</number>
        <prettyName>Asynchronous rendering</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </async_enabled>
      <code>
        <disabled>0</disabled>
        <editor>Text</editor>
        <name>code</name>
        <number>10</number>
        <prettyName>Macro code</prettyName>
        <rows>20</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentDescription>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>contentDescription</name>
        <number>9</number>
        <prettyName>Content description (Not applicable for "No content" type)</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </contentDescription>
      <contentJavaType>
        <cache>0</cache>
        <defaultValue>Unknown</defaultValue>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <freeText>allowed</freeText>
        <largeStorage>1</largeStorage>
        <multiSelect>0</multiSelect>
        <name>contentJavaType</name>
        <number>8</number>
        <picker>1</picker>
        <prettyName>Macro content type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Unknown|Wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentJavaType>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>7</number>
        <prettyName>Macro content availability</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Optional|Mandatory|No content</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <defaultCategory>
        <disabled>0</disabled>
        <name>defaultCategory</name>
        <number>4</number>
        <prettyName>Default category</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultCategory>
      <description>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>description</name>
        <number>3</number>
        <prettyName>Macro description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <id>
        <disabled>0</disabled>
        <name>id</name>
        <number>1</number>
        <prettyName>Macro id</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </id>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Macro name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <priority>
        <disabled>0</disabled>
        <name>priority</name>
        <number>11</number>
        <numberType>integer</numberType>
        <prettyName>Priority</prettyName>
        <size>10</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>
      </priority>
      <supportsInlineMode>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>supportsInlineMode</name>
        <number>5</number>
        <prettyName>Supports inline mode</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </supportsInlineMode>
      <visibility>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>visibility</name>
        <number>6</number>
        <prettyName>Macro visibility</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Current User|Current Wiki|Global</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </visibility>
    </class>
    <property>
      <async_cached>0</async_cached>
    </property>
    <property>
      <async_context/>
    </property>
    <property>
      <async_enabled>0</async_enabled>
    </property>
    <property>
      <code>{{velocity output="false"}}

## Format serialized comma-separated list coming from macro parameters
## so that it can be used inside a solr filter query parameter
## * Escape spaces inside values by wrapping them inside quotes,
##   making sure "+" and "-" filter modifiers stay outside the quotes
## * Remove commas so that values are separated only by spaces
#macro (formatSerializedList $serializedList $return)
  ## Wrap each value around quotes and replace commas by spaces
  ## (adds extra quotes / spaces at the beginning and end of the string)
  #set ($searchRegex = '(?:^|$|,)\s*([-+]?)')
  #set ($replacement = '" $1"')
  #set ($formatted = $!stringtool.replaceAll($serializedList, $searchRegex, $replacement))
  ## Remove extra quotes / spaces at the beginning and end of the string
  #set ($formatted = $!stringtool.substring($formatted, 2, -2))
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $formatted)
#end

## Format serialized comma-separated author list coming from macro parameters
## Author format is different between comments and document metadata
## ("xwiki:" wiki prefix is missing from comments author metadata)
## so add both versions in the formatted serialized list
#macro (formatSerializedAuthorList $serializedAuthorList $return)
  #set ($authorsList = [])
  #set ($splittedAuthorList = $!stringtool.split($serializedAuthorList, ','))
  #foreach ($author in $splittedAuthorList)
    #set ($author = $author.strip())
    #set ($searchRegex = '^([-+])?')
    #set ($replacement = '$1xwiki:')
    #set ($prefixedAuthor = $!stringtool.replaceAll($author, $searchRegex, $replacement))
    #set ($discard = $authorsList.add("$author"))
    #set ($discard = $authorsList.add("$prefixedAuthor"))
  #end
  #set ($authors = $!stringtool.join($authorsList, ','))
  #formatSerializedList($authors, $authors)
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $authors)
#end

#macro (parseTypes $serializedTypeList $return)
  #set ($allTypes = ['page', 'blogpost', 'attachment', 'comment'])
  #set ($types = [])
  #set ($typesDiscarded = [])
  #set ($splittedTypeList = $!stringtool.split($serializedTypeList, ','))
  ## Gather types based on wheter they are kept or discarded
  #foreach ($type in $splittedTypeList)
    #set ($type = $type.strip())
    #if ($type.startsWith('-'))
      #set ($usedTypeList = $typesDiscarded)
      #set ($type = $!stringtool.substring($type, 1))
    #else
      #set ($usedTypeList = $types)
    #end
    #if ($type.equals('page'))
      #set ($discard = $usedTypeList.add('page'))
    #elseif ($type.equals('blogpost') || $type.equals('news'))
      #set ($discard = $usedTypeList.add('blogpost'))
    #elseif ($type.equals('attachment'))
      #set ($discard = $usedTypeList.add('attachment'))
    #elseif ($type.equals('comment'))
      #set ($discard = $usedTypeList.add('comment'))
    #end
  #end
  ## Compute types to return
  #if ($types.size() == 0)
    #set ($types = $allTypes)
  #end
  #set ($discard = $types.removeAll($typesDiscarded))
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $types)
#end

## Authors
#set ($confluenceAuthorsString = "$!wikimacro.parameters.author.strip()")
#formatSerializedAuthorList($confluenceAuthorsString, $authors)

## Wiki &amp; Spaces
#set ($confluenceSpacesString = "$!wikimacro.parameters.spaces.strip()")
#set ($spaces = $NULL)
#set ($wiki = $doc.wiki)
#if (
  $confluenceSpacesString.equals('')
  || $confluenceSpacesString.equals('@self')
)
  ## Search in current space
  #set ($spaces = $doc.space)
#elseif (
  $confluenceSpacesString.equals('@personal')
  || $confluenceSpacesString.equals('@global')
  || $confluenceSpacesString.equals('@favorite')
  || $confluenceSpacesString.equals('@favourite')
)
  ## Search everywhere in current wiki
  ## `@personal`, `@favorite` and `@favourite` do not have an equivalent in XWiki,
  ## so make them fallback as `@global`
  #set ($wiki = $doc.wiki)
#elseif (
  $confluenceSpacesString.equals('@all')
  || $confluenceSpacesString.equals('*')
)
  ## Search everywhere in every wikis
  #set ($wiki = $NULL)
#else
  ## Search in specified spaces
  #formatSerializedList($confluenceSpacesString, $spaces)
#end

## Tags
#set ($confluenceLabelString = "$!wikimacro.parameters.labels.strip()")
#formatSerializedList($confluenceLabelString, $tags)

## Types
#set ($confluenceTypesString = "$!wikimacro.parameters.types.strip()")
#parseTypes($confluenceTypesString, $types)

## Limit
#set ($limit = $!wikimacro.parameters.max)

## Theme
#set ($availableTheme = ['concise', 'social', 'sidebar'])
#set ($theme = "$wikimacro.parameters.theme.strip()")
#if (!$availableTheme.contains($theme))
 #set ($theme = 'concise')
#end
#set ($ICON_BY_TYPE = {
  "DOCUMENT": 'page',
  "ATTACHMENT": 'attach',
  "OBJECT_PROPERTY": 'comment'
})
#set ($AUTHORING_TEXT_BY_TYPE = {
  "DOCUMENT": 'contributed',
  "ATTACHMENT": 'attached',
  "OBJECT_PROPERTY": 'commented'
})

#set ($widthStyle = "style='--width: $wikimacro.parameters.width'")
#set ($confluenceShowProfilePic = "$!wikimacro.parameters.showProfilePic")
#if ("$confluenceShowProfilePic" == "false" &amp;&amp; $theme == 'social')
  #set ($showProfilePic = false)
#elseif ("$confluenceShowProfilePic" == "true" || $theme == 'social')
  #set ($showProfilePic = true)
#else
  #set ($showProfilePic = false)
#end

#set ($authorExceptions = ['XWiki.superadmin', 'XWiki.XWikiGuest'])

#macro (displayAuthorName $author)
  &lt;span class="result-last-author-name"&gt;
    #if ($authorExceptions.contains($author))
      ${stringtool.substringAfter("$author", '.')}
    #else
      [[${author}]]
    #end
  &lt;/span&gt;
#end

#macro (displayAuthorAvatarURL $author)
  #set ($noavatarURL = $xwiki.getSkinFile('icons/xwiki/noavatar.png', true))
  #if ("$showProfilePic" == "true")
    &lt;span class="result-last-author-avatar"&gt;
      #if ($authorExceptions.contains($author))
        &lt;img class="avatar avatar_48" src="$noavatarURL" alt="$author" /&gt;
      #else
        #resizedUserAvatar("$result.author", 48)
      #end
    &lt;/span&gt;
  #end
#end
{{/velocity}}

{{velocity output="false"}}
#macro (queryDocuments $return)
  #set ($fq = [])
  #set ($query = $services.query.createQuery('name:*', 'solr'))
  ## Document filters
  #set ($discard = $fq.add('type:DOCUMENT'))
  #if ("$!wiki" != '')
    #set ($discard = $fq.add("wiki:($wiki)"))
  #end
  #if ("$!spaces" != '')
    #set ($discard = $fq.add("space:($spaces)"))
  #end
  #if ("$!authors" != '')
    #set ($discard = $fq.add("author:($authors)"))
  #end
  #if ("$!tags" == '')
    #set ($discard = $fq.add('class:(-Blog.BlogPostClass)'))
  #else
    #set ($discard = $fq.add('class:(-Blog.BlogPostClass AND XWiki.TagClass)'))
    #set ($discard = $fq.add("property.XWiki.TagClass.tags_string:($tags)"))
  #end
  ## Query params
  #set ($discard = $query.bindValue('fq', $fq))
  #set ($discard = $query.bindValue('sort', "date desc"))
  #set ($discard = $query.setOffset(0))
  #set ($discard = $query.setLimit($limit))
  #set ($response = $query.execute()[0])
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $response)
#end

#macro (queryBlogposts $return)
  #set ($fq = [])
  #set ($query = $services.query.createQuery('name:*', 'solr'))
  ## Document filters
  #set ($discard = $fq.add('type:DOCUMENT'))
  #if ("$!wiki" != '')
    #set ($discard = $fq.add("wiki:($wiki)"))
  #end
  #if ("$!spaces" != '')
    #set ($discard = $fq.add("space:($spaces)"))
  #end
  #if ("$!authors" != '')
    #set ($discard = $fq.add("author:($authors)"))
  #end
  #if ("$!tags" == '')
    #set ($discard = $fq.add('class:(Blog.BlogPostClass)'))
  #else
    #set ($discard = $fq.add('class:(Blog.BlogPostClass AND XWiki.TagClass)'))
    #set ($discard = $fq.add("property.XWiki.TagClass.tags_string:($tags)"))
  #end
  ## Query params
  #set ($discard = $query.bindValue('fq', $fq))
  #set ($discard = $query.bindValue('sort', "date desc"))
  #set ($discard = $query.setOffset(0))
  #set ($discard = $query.setLimit($limit))
  #set ($response = $query.execute()[0])
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $response)
#end

#macro (queryAttachments $return)
  #set ($fq = [])
  #set ($query = $services.query.createQuery('name:*', 'solr'))
  ## Attachment filters
  #set ($discard = $fq.add('type:ATTACHMENT'))
  #if ("$!wiki" != '')
    #set ($discard = $fq.add("wiki:($wiki)"))
  #end
  #if ("$!spaces" != '')
    #set ($discard = $fq.add("space:($spaces)"))
  #end
  #if ("$!authors" != '')
    #set ($discard = $fq.add("attauthor:($authors)"))
  #end
  ## Query params
  #set ($discard = $query.bindValue('fq', $fq))
  #set ($discard = $query.bindValue('sort', "attdate desc"))
  #set ($discard = $query.setOffset(0))
  #set ($discard = $query.setLimit($limit))
  #set ($response = $query.execute()[0])
  ## Create a clean `date` property to attachments
  #foreach ($attachment in $response.results)
    #set ($discard = $attachment.put('date', $attachment.attdate[0]))
    #set ($discard = $attachment.put('title_', $attachment.filename[0]))
    #set ($discard = $attachment.put('author', $attachment.attauthor[0]))
  #end
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $response)
#end

#macro (queryComments $return)
  #set ($fq = [])
  #set ($query = $services.query.createQuery('name:*', 'solr'))
  ## Comment filters
  #set ($discard = $fq.add('type:OBJECT_PROPERTY'))
  #set ($discard = $fq.add('class:XWiki.XWikiComments'))
  #if ("$!wiki" != '')
    #set ($discard = $fq.add("wiki:($wiki)"))
  #end
  #if ("$!spaces" != '')
    #set ($discard = $fq.add("space:($spaces)"))
  #end
  #set ($discard = $fq.add('propertyname:(author)'))
  #if ("$!authors" != '')
    #set ($discard = $fq.add("propertyvalue_:($authors)"))
  #end
  ## Query params
  #set ($discard = $query.bindValue('fq', $fq))
  #set ($discard = $query.bindValue('sort', "_version_ desc"))
  #set ($discard = $query.setOffset(0))
  #set ($discard = $query.setLimit($limit))
  #set ($response = $query.execute()[0])
  ## Add missing comment data
  #foreach ($comment in $response.results)
    #addCommentData($comment)
  #end
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $response)
#end

#macro (addCommentData $comment)
  ## Comment filters
  #set ($fq = [])
  #set ($query = $services.query.createQuery("name:$comment.name", 'solr'))
  #set ($discard = $fq.add('type:OBJECT_PROPERTY'))
  #set ($discard = $fq.add('class:XWiki.XWikiComments'))
  #set ($discard = $fq.add("wiki:($comment.wiki)"))
  #set ($discard = $fq.add("space:($comment.space)"))
  #set ($discard = $fq.add("number:($comment.number)"))
  ## Query params
  #set ($discard = $query.bindValue('fq', $fq))
  #set ($discard = $query.setOffset(0))
  #set ($discard = $query.setLimit(3))
  #set ($commentResponse = $query.execute()[0])
  ## Add data to result
  #foreach ($property in $commentResponse.results)
    #if ($property.propertyname == 'date')
      #set ($dateFormat = $datetool.getDateFormat("EEE MMM dd HH:mm:ss z yyyy", $datetool.getLocale(), $datetool.getTimeZone()))
      #set ($date = $dateFormat.parse($property.propertyvalue_[0]))
      #set ($discard = $comment.put('date', $date))
    #elseif ($property.propertyname == 'author')
      #set ($discard = $comment.put('author', "$property.propertyvalue_[0]"))
    #elseif ($property.propertyname == 'comment')
      #set ($discard = $comment.put('comment', $property.propertyvalue_[0]))
    #end
  #end
#end

## Results can be of type document, attachment, or comment
## As results are fetched from three different requests (1 for each type)
## We need to merge those results together into one unique list of results.
## During the merge, we have to make sure we respects two things:
## - results are still sorted by most recent ones first
## - the number of results is no more than the limit defined in the macro parameter
#macro (mergeSortLimitResults $resultLists $return)
  #set ($results = [])
  #foreach ($discard in [1..$limit])
    #set ($mostRecentDate = $NULL)
    #set ($listIndex = $NULL)
    ## Search throught the lists of results the most recent result
    ## Lists are already sorted by themselves,
    ## so we just need to compare the first result of each list
    #foreach ($resultList in $resultLists)
      #if ($resultList.size() &gt; 0)
        ## Flag result if it is the most recent found until now
        #set ($date = $resultList[0].date)
        #if ($mostRecentDate == $NULL || $datetool.difference($mostRecentDate, $date).getMilliseconds() &gt; 0)
          #set ($mostRecentDate = $date)
          #set ($listIndex = $foreach.index)
        #end
      #end
    #end
    ## Use the most recent result found
    #if ($listIndex == $NULL)
      #break
    #else
      #set ($discard = $results.add($resultLists[$listIndex][0]))
      #set ($discard = $resultLists[$listIndex].remove(0))
    #end
  #end
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $results)
#end

## Resolve some metadata for results
## Metadata computed here are the one heavy to compute,
## because they use the document object associated to the result.
## So we compute those metadata the latest possible,
## only for the results we are sure to display
#macro (resolveResultsMetadata $results)
  #foreach ($result in $results)
    #set ($documentFullname = "${result.wiki}:${result.space}.${result.name}")
    #set ($document = $xwiki.getDocument($documentFullname))
    #if ($result.type.equals('DOCUMENT'))
      #set ($discard = $result.put('href', $document.getURL()))
    #elseif ($result.type.equals('ATTACHMENT'))
      #set ($discard = $result.put('href', $document.getAttachmentURL($result.filename[0], 'viewattachrev')))
    #elseif ($result.type.equals('OBJECT_PROPERTY'))
      #set ($discard = $result.put('href', "$document.getURL('view', 'viewer=comments')#xwikicomment_${result.number}"))
      #set ($discard = $result.put('title_', $document.title))
    #end
  #end
#end

#macro (fetchResults $return)
  ## Fetch data
  #set ($queryResponses = [])
  #if ($types.contains('page'))
    #queryDocuments($documentsResponse)
    #set ($discard = $queryResponses.add($documentsResponse.results))
  #end
  #if ($types.contains('blogpost'))
    #queryBlogposts($blogpostResponse)
    #set ($discard = $queryResponses.add($blogpostResponse.results))
  #end
  #if ($types.contains('attachment'))
    #queryAttachments($attachmentsResponse)
    #set ($discard = $queryResponses.add($attachmentsResponse.results))
  #end
  #if ($types.contains('comment'))
    #queryComments($commentsResponse)
    #set ($discard = $queryResponses.add($commentsResponse.results))
  #end
  ## Resolve used data
  #mergeSortLimitResults($queryResponses $results)
  #resolveResultsMetadata($results)
  ## Return
  #set ($return = $NULL)
  #setVariable("$return" $results)
#end

#fetchResults($results)

{{/velocity}}

{{velocity}}
$xwiki.ssx.use('xwiki:Confluence.Macros.recently-updated')
##
#set ($socialThemePreviousAuthor = $NULL)
##
{{html clean="false"}}
  &lt;section class="recently-updated-macro" $widthStyle&gt;
    #if ("$wikimacro.parameters.hideHeading" != "true")
      &lt;h2&gt;Recently Updated&lt;/h2&gt;
    #end

    &lt;ul class="items theme-${theme}"&gt;
{{/html}}

{{html clean="false" wiki="true"}}
      #foreach ($result in $results)
        #if ($theme == 'sidebar')
          ## Theme sidebar - start
          &lt;li&gt;
            &lt;div class="result-item"&gt;
              [[image:icon:${ICON_BY_TYPE[$result.type]}||class="document-icon"]]
              &lt;span class="result-title"&gt;
                &lt;a href="${result.href}"&gt;${result.title_}&lt;/a&gt;
              &lt;/span&gt;
              &lt;span class="result-metadata"&gt;
                &lt;span class="result-last-author-text"&gt;${AUTHORING_TEXT_BY_TYPE[$result.type]}&lt;/span&gt;
                #displayAuthorAvatarURL(${result.author})
                $services.date.displayTimeAgo(${result.date})
              &lt;/span&gt;
            &lt;/div&gt;
          &lt;/li&gt;
          ## Theme sidebar - end
        #elseif ($theme == 'social')
          ## Theme social - start
          #set ($socialThemeIsSameAuthor = $result.author.equals($socialThemePreviousAuthor))
          #set ($socialThemePreviousAuthor = $result.author)
          #set ($socialThemeCollapseClass = '')
          #if ($socialThemeIsSameAuthor)
            #set ($socialThemeCollapseClass = 'collapsed')
          #end
          &lt;li&gt;
            &lt;div class="result-container $socialThemeCollapseClass"&gt;
              #displayAuthorAvatarURL(${result.author})
              &lt;div class="result-items"&gt;
                #displayAuthorName(${result.author})
                &lt;div class="result-item"&gt;
                  [[image:icon:${ICON_BY_TYPE[$result.type]}||class="result-icon"]]
                  &lt;span class="result-title"&gt;
                    &lt;a href="${result.href}"&gt;${result.title_}&lt;/a&gt;
                  &lt;/span&gt;
                  &lt;span class="result-metadata"&gt;
                    &lt;span class="result-last-author-text"&gt;${AUTHORING_TEXT_BY_TYPE[$result.type]}&lt;/span&gt;
                    $services.date.displayTimeAgo(${result.date})
                  &lt;/span&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/li&gt;
          ## Theme social - end
        #else
          ## Theme concise - start
          &lt;li&gt;
            &lt;div class="result-item"&gt;
              [[image:icon:${ICON_BY_TYPE[$result.type]}||class="result-icon"]]
              &lt;span class="result-title"&gt;
                &lt;a href="${result.href}"&gt;${result.title_}&lt;/a&gt;
              &lt;/span&gt;
              &lt;span class="result-metadata"&gt;
                $services.date.displayTimeAgo(${result.date})
                &lt;span class="separator"&gt;⋅&lt;/span&gt;
                &lt;span class="result-last-author-text"&gt;${AUTHORING_TEXT_BY_TYPE[$result.type]} by&lt;/span&gt;
                #displayAuthorAvatarURL(${result.author})
                #displayAuthorName(${result.author})
              &lt;/span&gt;
            &lt;/div&gt;
          &lt;/li&gt;
          ## Theme concise - end
        #end
      #end
    &lt;/ul&gt;

  &lt;/section&gt; ## .recently-updated-macro
{{/html}}
{{/velocity}}
</code>
    </property>
    <property>
      <contentDescription/>
    </property>
    <property>
      <contentJavaType/>
    </property>
    <property>
      <contentType>No content</contentType>
    </property>
    <property>
      <defaultCategory>confluence</defaultCategory>
    </property>
    <property>
      <description>Add the Recently Updated macro to a page to show a list of pages, blogs, files, and comments that have been created or edited recently. 

This is great for:
- project landing or information pages
- team space home pages

It's very flexible, you can limit the list to specific people, spaces, types of content, and more. </description>
    </property>
    <property>
      <id>recently-updated</id>
    </property>
    <property>
      <name>Recently Updated</name>
    </property>
    <property>
      <priority/>
    </property>
    <property>
      <supportsInlineMode>0</supportsInlineMode>
    </property>
    <property>
      <visibility>Global</visibility>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>0</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>e948b899-15a1-4af1-8d3a-3016d74c6f9d</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Filter the results by author. The macro will display only the pages etc which were last modified by the author(s) you specify here. You can specify multiple users.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>author</name>
    </property>
    <property>
      <type>java.lang.String</type>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>1</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>86b78bac-28e6-48be-8f19-ffdbf9bcbd4a</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>@self</defaultValue>
    </property>
    <property>
      <description>This parameter allows you to filter content by space. The macro will display only the pages etc which belong to the space(s) you specify here. You can specify one or more space keys, separated by a comma or a space. To exclude content in a specific space, put a minus sign (-) immediately in front of that space key. For example: If you specify a space key of -BADSPACE you will get only content which is not in the BADSPACE. To indicate that the results must come from a specific space, put a plus sign (+) immediately in front of that space key. For example: If you specify a space key of +GOODSPACE you will get only content in GOODSPACE. (Note that this is not particularly useful, because each content item belongs to one space only. If you put a plus sign next to one space key and list other space keys too, the other space keys will be ignored.) Special values: "@self" - the current space, "@global" - all spaces in wiki, "@all" or "*" - all spaces in every wiki</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>spaces</name>
    </property>
    <property>
      <type>java.lang.String</type>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>2</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>b077519c-dc5e-4c77-b7d5-1f882653aca6</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Filter the results by label. The macro will display only the pages etc which are tagged with the label(s) you specify here. You can specify one or more label values, separated by a comma or a space. To exclude content which matches a given label, put a minus sign (-) immediately in front of that label value. For example: If you specify a label value of -badpage you will get only content which is not labeled with 'badpage'. To indicate that the results** **must match a given label value, put a plus sign (+) immediately in front of that label value. For example: If you specify a label value of +superpage,+goodpage you will get only content which has at least two labels, being 'superpage' and 'goodpage'. The labels parameter only applies to the page and blog content types.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>labels</name>
    </property>
    <property>
      <type>java.lang.String</type>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>3</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>199498c6-e761-4540-adb6-2db2c923dfbb</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>100</defaultValue>
    </property>
    <property>
      <description>Specify the width of the macro display, as a percentage of the window width.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>width</name>
    </property>
    <property>
      <type>java.lang.String</type>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>4</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>fb726f4f-3e4a-4cc8-b608-f0ceeb5b1926</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>This parameter allows you to filter content by content type. The macro will display only the content of the type you specify here. You can specify one or more types, separated by a comma or a space. To exclude content of a given content type, put a minus sign (-) immediately in front of that content type. For example: If you specify a content type of -blogpost you will get pages and all other content except for blog posts. Available values: "page" - documents, "blogpost" or "news" - blogpost documents, "comment" - comments on documents, "attachment" - attachments</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>types</name>
    </property>
    <property>
      <type>java.lang.String</type>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>5</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>149d0152-37f8-43f2-8012-3a520e07cdbe</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>15</defaultValue>
    </property>
    <property>
      <description>Specify the maximum number of results to be displayed. If this parameter is omitted, then a maximum of 15 results are displayed.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>max</name>
    </property>
    <property>
      <type>java.lang.Integer</type>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>6</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>12108df7-3386-4932-91c1-63ce3c7bd6bd</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>concise</defaultValue>
    </property>
    <property>
      <description>Choose the appearance of this macro: "concise" - the default list, showing the names of pages which were updated or commented on, the users who made the page modifications and time when the modifications occurred. "social" - lists recent modifications in reverse chronological order, but groups them by user into short time segments. A 'sub' list appears within each user's time segment, showing the names of pages which they updated or commented on and time when these modifications occurred. "sidebar" - lists recent updates in reverse chronological order, showing the names of pages which were updated or commented on and time when the page modifications occurred. This theme does not show authorship.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>theme</name>
    </property>
    <property>
      <type>java.lang.String</type>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>7</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>5e5b16a3-9463-4f0c-949e-411e9d7e3359</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Specify "showProfilePic=true" to display the profile pictures of the users who updated the content.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>showProfilePic</name>
    </property>
    <property>
      <type>java.lang.Boolean</type>
    </property>
  </object>
  <object>
    <name>Confluence.Macros.recently-updated</name>
    <number>8</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>4b67c758-6063-4326-be0a-6a47d2e2ac5f</guid>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <type>
        <disabled>0</disabled>
        <name>type</name>
        <number>5</number>
        <prettyName>Parameter type</prettyName>
        <size>60</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </type>
    </class>
    <property>
      <defaultValue>false</defaultValue>
    </property>
    <property>
      <description>Determines whether the macro hides or displays the text 'Recently Updated' as a title above the list of content. Only available in wikimarkup and storage format. Accepted values: "true" - Title is hidden, "false" - Title is shown.</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>hideHeading</name>
    </property>
    <property>
      <type>java.lang.Boolean</type>
    </property>
  </object>
</xwikidoc>
